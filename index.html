<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CS2 Autoexec Configurator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #060911;
      --bg-soft: #0f1624;
      --bg-lift: #172338;
      --card: rgba(15, 22, 36, 0.88);
      --border: rgba(91, 115, 168, 0.18);
      --text: #f5f7ff;
      --text-soft: #9aa4bc;
      --accent: linear-gradient(135deg, #5ef4c7 0%, #2aa9e0 100%);
      --accent-solid: #49c6e0;
      --danger: #f15b6c;
      --shadow: 0 25px 60px -30px rgba(16, 24, 40, 0.75);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Space Grotesk", system-ui, -apple-system, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, rgba(79, 110, 255, 0.28), transparent 42%),
                  radial-gradient(circle at 15% 80%, rgba(75, 255, 195, 0.16), transparent 58%),
                  radial-gradient(circle at 85% 20%, rgba(170, 134, 255, 0.18), transparent 55%),
                  var(--bg);
      min-height: 100vh;
      color: var(--text);
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, rgba(31, 47, 80, 0.28), rgba(7, 10, 20, 0.4));
      pointer-events: none;
      z-index: -1;
    }

    a { color: inherit; }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(14px) saturate(1.5);
      background: rgba(8, 12, 24, 0.82);
      border-bottom: 1px solid rgba(97, 123, 189, 0.16);
      box-shadow: 0 1px 0 rgba(149, 173, 255, 0.05);
    }

    .wrap {
      width: min(1200px, 92vw);
      margin: 0 auto;
      padding: 18px 0 20px;
    }

    .top-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      align-items: center;
      justify-content: space-between;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand h1 {
      margin: 0;
      font-size: clamp(1.4rem, 1.2rem + 1vw, 2.05rem);
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .brand .tagline {
      margin: 0;
      font-size: 0.95rem;
      color: var(--text-soft);
      max-width: 420px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 10px;
      border-radius: 999px;
      background: rgba(83, 138, 255, 0.14);
      border: 1px solid rgba(107, 157, 255, 0.22);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #c2d3ff;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-end;
    }

    button {
      font: inherit;
      font-weight: 600;
      letter-spacing: 0.01em;
      border-radius: 12px;
      padding: 11px 18px;
      border: 0;
      cursor: pointer;
      position: relative;
      transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
      color: #071521;
      background-image: var(--accent);
      box-shadow: 0 16px 30px -20px rgba(90, 221, 237, 0.9);
    }

    button:hover { transform: translateY(-1px); filter: brightness(1.05); }
    button:active { transform: translateY(0); filter: brightness(0.98); }

    button.secondary {
      background: rgba(27, 40, 66, 0.85);
      color: var(--text);
      border: 1px solid rgba(115, 143, 206, 0.4);
      box-shadow: none;
    }

    button.ghost {
      background: rgba(13, 19, 32, 0.45);
      border: 1px solid rgba(122, 150, 214, 0.35);
      color: var(--text);
      box-shadow: none;
    }

    button.danger {
      background: var(--danger);
      color: #fff;
      box-shadow: none;
    }

    button[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
    }

    label.btn-upload {
      background: rgba(13, 19, 32, 0.45);
      border: 1px dashed rgba(122, 150, 214, 0.35);
      color: var(--text);
      box-shadow: none;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .landing {
      min-height: clamp(440px, 60vh, 520px);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 96px 12px 60px;
    }

    .landing .bubble {
      position: relative;
      padding: 52px clamp(18px, 4vw, 72px);
      border-radius: 30px;
      background: rgba(12, 19, 33, 0.7);
      border: 1px solid rgba(107, 157, 255, 0.18);
      box-shadow: var(--shadow);
      backdrop-filter: blur(26px);
      max-width: 720px;
    }

    .landing h2 {
      margin: 0 0 12px;
      font-size: clamp(2.1rem, 1.6rem + 2.6vw, 3.4rem);
      letter-spacing: -0.02em;
    }

    .landing p {
      margin: 0 auto 28px;
      max-width: 480px;
      color: var(--text-soft);
      font-size: 1.05rem;
      line-height: 1.65;
    }

    .landing .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 18px;
      margin-top: 28px;
      text-align: left;
      color: var(--text-soft);
      font-size: 0.95rem;
    }

    main {
      display: none;
    }

    #app.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 18px;
      margin-bottom: 60px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 20px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .card::after {
      content: "";
      position: absolute;
      inset: -120px -60px auto auto;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(90, 221, 237, 0.18), transparent 65%);
      opacity: 0.45;
      pointer-events: none;
      transition: transform 0.5s ease;
    }

    .card:hover::after { transform: translate(-10px, 6px) scale(1.04); }

    .card h3 {
      margin: 0 0 18px;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.18em;
      color: #bfcaf3;
      text-transform: uppercase;
    }

    .col-12 { grid-column: span 12; }
    .col-8 { grid-column: span 8; }
    .col-6 { grid-column: span 6; }
    .col-5 { grid-column: span 5; }
    .col-4 { grid-column: span 4; }
    .col-3 { grid-column: span 3; }

    @media (max-width: 1120px) {
      .col-5, .col-4, .col-3 { grid-column: span 6; }
    }
    @media (max-width: 860px) {
      header { position: static; }
      .top-bar { justify-content: center; }
      .brand { align-items: center; text-align: center; }
      .actions { justify-content: center; }
      .landing { padding-top: 64px; }
      .dashboard { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .col-8 { grid-column: span 2; }
      .col-6 { grid-column: span 2; }
      .col-5 { grid-column: span 2; }
      .col-4 { grid-column: span 2; }
      .col-3 { grid-column: span 1; }
      .col-12 { grid-column: span 2; }
    }
    @media (max-width: 640px) {
      .dashboard { grid-template-columns: 1fr; }
      .col-12, .col-8, .col-6, .col-5, .col-4, .col-3 { grid-column: span 1; }
      .actions { width: 100%; }
      .actions button, label.btn-upload { flex: 1 1 auto; }
      .landing .bubble { padding: 40px 26px; }
    }

    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 14px 16px;
    }

    label {
      display: block;
      font-size: 0.8rem;
      letter-spacing: 0.04em;
      margin-bottom: 6px;
      color: rgba(197, 210, 255, 0.8);
      text-transform: uppercase;
    }

    input, select, textarea {
      width: 100%;
      background: rgba(10, 16, 28, 0.86);
      border: 1px solid rgba(126, 152, 216, 0.22);
      border-radius: 14px;
      padding: 12px 14px;
      font: inherit;
      color: var(--text);
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: rgba(94, 244, 199, 0.65);
      box-shadow: 0 0 0 3px rgba(94, 244, 199, 0.15);
    }

    input[disabled] {
      opacity: 0.7;
    }

    textarea {
      min-height: 140px;
      resize: vertical;
    }

    pre {
      background: rgba(7, 11, 22, 0.92);
      border: 1px solid rgba(91, 115, 168, 0.25);
      border-radius: 16px;
      padding: 18px;
      font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, SFMono, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: 0.88rem;
      line-height: 1.6;
      color: #e2e9ff;
      max-height: 360px;
      overflow: auto;
      background-image: linear-gradient(180deg, rgba(52, 67, 104, 0.35), transparent 48%);
    }

    .hint {
      font-size: 0.82rem;
      color: var(--text-soft);
      margin-top: 10px;
    }

    .footer {
      margin: 48px 0 24px;
      text-align: center;
      color: var(--text-soft);
      font-size: 0.82rem;
      letter-spacing: 0.04em;
    }

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(5, 8, 16, 0.78);
      backdrop-filter: blur(16px);
      z-index: 50;
      padding: 24px;
    }

    .modal.active { display: flex; }

    .modal .box {
      width: min(420px, 92vw);
      background: rgba(12, 19, 33, 0.92);
      border: 1px solid rgba(97, 123, 189, 0.3);
      border-radius: 20px;
      padding: 26px;
      box-shadow: var(--shadow);
    }

    .modal .btns { margin-top: 16px; }

    input::-webkit-inner-spin-button,
    input::-webkit-outer-spin-button { height: auto; }

    #app .card-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap top-bar">
      <div class="brand">
        <span class="chip">CS2</span>
        <h1>Autoexec Configurator</h1>
        <p class="tagline">Sammensæt, gem og del din <strong>autoexec.cfg</strong> med et elegant værktøj designet til både grinders og holdkaptajner.</p>
      </div>
      <div class="actions">
        <button id="btn-generate">Generér</button>
        <button id="btn-download" class="secondary">Download autoexec.cfg</button>
        <label for="file-import" class="ghost btn-upload">Importér autoexec.cfg</label>
        <input id="file-import" type="file" accept=".cfg,.txt" hidden />
        <button id="btn-copy" class="ghost">Kopiér</button>
        <button id="btn-save-cloud" class="ghost">Gem i skyen</button>
        <button id="btn-load-cloud" class="ghost">Hent fra skyen</button>
        <button id="btn-auth" class="ghost">Log ind</button>
        <button id="btn-logout" class="danger" style="display:none">Log ud</button>
        <button id="btn-reset" class="danger">Nulstil</button>
      </div>
    </div>
  </header>

  <section id="landing" class="landing">
    <div class="bubble">
      <h2>Slip for konsollen.<br>Fokuser på headshots.</h2>
      <p>Lav og tweak din <span class="chip">autoexec.cfg</span> i en moderne editor. Gem lokalt eller i skyen via Supabase og synkroniser på tværs af maskiner.</p>
      <div class="actions" style="justify-content:center;margin-bottom:16px;">
        <button id="landing-signup">Kom i gang gratis</button>
        <button id="landing-login" class="secondary">Log ind</button>
      </div>
      <div class="stats">
        <div>
          <strong style="font-size:1.6rem;color:#5ef4c7;display:block;">5+ presets</strong>
          Gode udgangspunkter til crosshair, viewmodel og netværk.
        </div>
        <div>
          <strong style="font-size:1.6rem;color:#9aa4ff;display:block;">Sky-gem</strong>
          Gem sikkert via Supabase og hent config på sekunder.
        </div>
        <div>
          <strong style="font-size:1.6rem;color:#f5f7ff;display:block;">Importér</strong>
          Upload din eksisterende cfg og få felterne udfyldt automatisk.
        </div>
      </div>
    </div>
  </section>

  <main id="app" class="wrap">
    <div class="dashboard">
      <section class="card col-12">
        <div class="card-title-row">
          <h3>Forudindstillinger</h3>
          <div class="hint">Vælg et udgangspunkt og justér derefter alle værdier.</div>
        </div>
        <div class="row" style="align-items:end; grid-template-columns: minmax(220px, 320px) auto;">
          <div>
            <label for="preset-select">Preset</label>
            <select id="preset-select"></select>
          </div>
          <div class="actions" style="justify-content:flex-start;">
            <button id="preset-apply">Indlæs preset</button>
          </div>
        </div>
      </section>

      <section class="card col-4">
        <h3>Mus & Sens</h3>
        <div class="row">
          <div>
            <label>Fysisk DPI</label>
            <input id="dpi" type="number" min="50" max="32000" step="50" value="800" />
          </div>
          <div>
            <label>Sensitivity</label>
            <input id="sensitivity" type="number" min="0.01" max="10" step="0.01" value="1.0" />
          </div>
          <div>
            <label>Zoom sens</label>
            <input id="zoom_sens" type="number" min="0.2" max="2" step="0.01" value="1.0" />
          </div>
          <div>
            <label>m_rawinput</label>
            <select id="m_rawinput"><option value="1">1</option><option value="0">0</option></select>
          </div>
          <div>
            <label>m_mouseaccel</label>
            <select id="m_mouseaccel"><option value="0">0</option><option value="1">1</option></select>
          </div>
          <div>
            <label>eDPI (beregnet)</label>
            <input id="edpi" type="text" disabled value="800" />
          </div>
        </div>
        <div class="hint">eDPI = DPI × sensitivity. Hold musen konsekvent ved at matche din fysiske følelse.</div>
      </section>

      <section class="card col-4">
        <h3>Crosshair</h3>
        <div class="row">
          <div>
            <label>Størrelse</label>
            <input id="ch_size" type="number" step="0.1" value="2.5" />
          </div>
          <div>
            <label>Tykkelse</label>
            <input id="ch_thickness" type="number" step="0.1" value="0.8" />
          </div>
          <div>
            <label>Gap</label>
            <input id="ch_gap" type="number" step="0.1" value="-2" />
          </div>
          <div>
            <label>Alpha</label>
            <input id="ch_alpha" type="number" min="0" max="255" value="255" />
          </div>
          <div>
            <label>Farve (RGB)</label>
            <div class="row" style="grid-template-columns: repeat(3, minmax(80px, 1fr));">
              <input id="ch_r" type="number" min="0" max="255" value="0" />
              <input id="ch_g" type="number" min="0" max="255" value="255" />
              <input id="ch_b" type="number" min="0" max="255" value="170" />
            </div>
          </div>
          <div>
            <label>Outline</label>
            <select id="ch_outline"><option value="1">1</option><option value="0">0</option></select>
          </div>
          <div>
            <label>Outline tykkelse</label>
            <input id="ch_outline_thickness" type="number" step="0.1" value="1" />
          </div>
          <div>
            <label>Dot</label>
            <select id="ch_dot"><option value="0">0</option><option value="1">1</option></select>
          </div>
        </div>
      </section>

      <section class="card col-4">
        <h3>Viewmodel</h3>
        <div class="row">
          <div>
            <label>viewmodel_fov</label>
            <input id="vm_fov" type="number" step="1" value="68" />
          </div>
          <div>
            <label>viewmodel_offset_x</label>
            <input id="vm_x" type="number" step="0.5" value="2.5" />
          </div>
          <div>
            <label>viewmodel_offset_y</label>
            <input id="vm_y" type="number" step="0.5" value="0" />
          </div>
          <div>
            <label>viewmodel_offset_z</label>
            <input id="vm_z" type="number" step="0.5" value="-1.5" />
          </div>
        </div>
      </section>

      <section class="card col-6">
        <h3>Netværk & Lyd</h3>
        <div class="row">
          <div>
            <label>rate</label>
            <input id="rate" type="number" step="1" value="786432" />
          </div>
          <div>
            <label>cl_cmdrate</label>
            <input id="cmdrate" type="number" value="128" />
          </div>
          <div>
            <label>cl_updaterate</label>
            <input id="updaterate" type="number" value="128" />
          </div>
          <div>
            <label>snd_mixahead</label>
            <input id="mixahead" type="number" step="0.01" value="0.025" />
          </div>
          <div>
            <label>volume</label>
            <input id="volume" type="number" step="0.01" min="0" max="1" value="0.4" />
          </div>
          <div>
            <label>voice_enable</label>
            <select id="voice_enable"><option value="1">1</option><option value="0">0</option></select>
          </div>
        </div>
      </section>

      <section class="card col-6">
        <h3>Keybinds</h3>
        <div class="row">
          <div>
            <label>Jumpthrow</label>
            <input id="bind_jumpthrow" placeholder="f.eks. v" value="v" />
          </div>
          <div>
            <label>Quick switch</label>
            <input id="bind_quickswitch" placeholder="f.eks. q" value="q" />
          </div>
        </div>
        <div class="hint">Efterlad felterne tomme for at springe binds over.</div>
      </section>

      <section class="card col-12">
        <h3>Egne linjer</h3>
        <textarea id="custom" rows="5" placeholder="Skriv ekstra cvars eller ekko-kommentarer her..."></textarea>
      </section>

      <section class="card col-12">
        <div class="card-title-row">
          <h3>autoexec.cfg</h3>
          <div class="actions" style="justify-content:flex-end; gap:8px;">
            <button id="btn-generate-2">Generér igen</button>
            <button id="btn-download-2" class="secondary">Download</button>
            <button id="btn-selftest" class="ghost">Kør selvtest</button>
          </div>
        </div>
        <pre id="output">// Klik "Generér" for at se indholdet her.
// Placér filen som: Steam\\steamapps\\common\\Counter-Strike Global Offensive\\game\\csgo\\cfg\\autoexec.cfg
// Startargument i Steam: +exec autoexec.cfg</pre>
      </section>
    </div>

    <div class="footer">Gemmes lokalt i din browser eller i skyen via Supabase.</div>
  </main>

  <div id="auth-modal" class="modal">
    <div class="box">
      <h3 style="margin-top:0;text-transform:uppercase;letter-spacing:0.18em;color:#bfcaf3;">Login</h3>
      <label>Email</label>
      <input id="auth-email" type="email" placeholder="you@example.com" />
      <label>Kodeord</label>
      <input id="auth-password" type="password" placeholder="••••••••" />
      <div class="actions" style="margin-top:18px;justify-content:flex-start;">
        <button id="auth-signup">Opret konto</button>
        <button id="auth-login" class="secondary">Log ind</button>
        <button id="auth-close" class="ghost">Luk</button>
      </div>
      <div class="hint" style="margin-top:18px;">Din autoexec gemmes kun på din konto (RLS).</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const PRESETS = {
      "Clean – lille crosshair": {
        dpi: 800, sensitivity: 1.0, zoom_sens: 1.0, m_rawinput: 1, m_mouseaccel: 0,
        ch_size: 2.5, ch_thickness: 0.8, ch_gap: -2, ch_alpha: 255,
        ch_r: 0, ch_g: 255, ch_b: 170, ch_outline: 1, ch_outline_thickness: 1, ch_dot: 0,
        vm_fov: 68, vm_x: 2.5, vm_y: 0, vm_z: -1.5,
        rate: 786432, cmdrate: 128, updaterate: 128, mixahead: 0.025,
        volume: 0.4, voice_enable: 1
      },
      "Dot – minimal": {
        dpi: 800, sensitivity: 1.1, zoom_sens: 1.0, m_rawinput: 1, m_mouseaccel: 0,
        ch_size: 1, ch_thickness: 0, ch_gap: -3, ch_alpha: 255,
        ch_r: 255, ch_g: 255, ch_b: 255, ch_outline: 1, ch_outline_thickness: 1, ch_dot: 1,
        vm_fov: 68, vm_x: 2.5, vm_y: 0, vm_z: -1.5,
        rate: 786432, cmdrate: 128, updaterate: 128, mixahead: 0.02,
        volume: 0.4, voice_enable: 1
      },
      "Classic – større outline": {
        dpi: 800, sensitivity: 0.9, zoom_sens: 1.0, m_rawinput: 1, m_mouseaccel: 0,
        ch_size: 3, ch_thickness: 1, ch_gap: -1, ch_alpha: 255,
        ch_r: 0, ch_g: 255, ch_b: 0, ch_outline: 1, ch_outline_thickness: 2, ch_dot: 0,
        vm_fov: 68, vm_x: 2.5, vm_y: 0, vm_z: -1.5,
        rate: 786432, cmdrate: 128, updaterate: 128, mixahead: 0.025,
        volume: 0.5, voice_enable: 1
      },
      "Valve MM – 64 tick": {
        dpi: 800, sensitivity: 1.0, zoom_sens: 1.0, m_rawinput: 1, m_mouseaccel: 0,
        ch_size: 2.5, ch_thickness: 0.8, ch_gap: -2, ch_alpha: 255,
        ch_r: 0, ch_g: 255, ch_b: 170, ch_outline: 1, ch_outline_thickness: 1, ch_dot: 0,
        vm_fov: 68, vm_x: 2.5, vm_y: 0, vm_z: -1.5,
        rate: 262144, cmdrate: 64, updaterate: 64, mixahead: 0.03,
        volume: 0.4, voice_enable: 1
      }
    };

    function populatePresets() {
      const sel = document.getElementById('preset-select');
      if (!sel) return;
      sel.innerHTML = '';
      Object.keys(PRESETS).forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        sel.appendChild(opt);
      });
      if (sel.options.length) sel.selectedIndex = 0;
    }

    function applyPreset(name) {
      const preset = PRESETS[name];
      if (!preset) return;
      Object.entries(preset).forEach(([key, value]) => {
        const input = document.getElementById(key);
        if (input !== null) input.value = value;
      });
      updateEdpi();
      saveState();
      generateCfg();
    }
  </script>
  <script>
    const $ = (id) => document.getElementById(id);
    const on = (id, handler) => { const el = $(id); if (el) el.onclick = handler; };
    const show = (el, on = true) => { if (typeof el === 'string') el = $(el); if (el) el.style.display = on ? '' : 'none'; };

    const fields = [
      'dpi','sensitivity','zoom_sens','m_rawinput','m_mouseaccel','ch_size','ch_thickness','ch_gap','ch_alpha','ch_r','ch_g','ch_b','ch_outline','ch_outline_thickness','ch_dot','vm_fov','vm_x','vm_y','vm_z','rate','cmdrate','updaterate','mixahead','volume','voice_enable','bind_jumpthrow','bind_quickswitch','custom'
    ];

    function loadState() {
      const raw = localStorage.getItem('cs2_cfg_state');
      if (!raw) return;
      try {
        const s = JSON.parse(raw);
        fields.forEach(k => { if (s[k] !== undefined && $(k)) $(k).value = s[k]; });
      } catch {}
      updateEdpi();
    }

    function saveState() {
      const s = {};
      fields.forEach(k => s[k] = $(k).value);
      localStorage.setItem('cs2_cfg_state', JSON.stringify(s));
    }

    function updateEdpi() {
      const dpi = parseFloat($('dpi').value || 0);
      const sens = parseFloat($('sensitivity').value || 0);
      const edpi = Math.round(dpi * sens);
      $('edpi').value = Number.isFinite(edpi) ? edpi : '';
    }

    function cfgLine(key, val) {
      return `${key} ${typeof val === 'string' && /\s/.test(val) ? '"' + val + '"' : val}`;
    }

    function generateCfg() {
      const v = Object.fromEntries(fields.map(k => [k, $(k).value]));
      const lines = [];
      lines.push('// === CS2 AUTOEXEC GENERERET AF WEB ===');
      lines.push('echo "AUTOEXEC LOADED"');
      lines.push('con_enable "1"');

      lines.push(cfgLine('sensitivity', v.sensitivity));
      lines.push(cfgLine('zoom_sensitivity_ratio_mouse', v.zoom_sens));
      lines.push(cfgLine('m_rawinput', v.m_rawinput));
      lines.push(cfgLine('m_mouseaccel1', v.m_mouseaccel));
      lines.push(cfgLine('m_mouseaccel2', v.m_mouseaccel));

      lines.push(cfgLine('cl_crosshairsize', v.ch_size));
      lines.push(cfgLine('cl_crosshairthickness', v.ch_thickness));
      lines.push(cfgLine('cl_crosshairgap', v.ch_gap));
      lines.push(cfgLine('cl_crosshairalpha', v.ch_alpha));
      lines.push(cfgLine('cl_crosshaircolor_r', v.ch_r));
      lines.push(cfgLine('cl_crosshaircolor_g', v.ch_g));
      lines.push(cfgLine('cl_crosshaircolor_b', v.ch_b));
      lines.push(cfgLine('cl_crosshair_drawoutline', v.ch_outline));
      lines.push(cfgLine('cl_crosshair_outlinethickness', v.ch_outline_thickness));
      lines.push(cfgLine('cl_crosshairdot', v.ch_dot));

      lines.push(cfgLine('viewmodel_fov', v.vm_fov));
      lines.push(cfgLine('viewmodel_offset_x', v.vm_x));
      lines.push(cfgLine('viewmodel_offset_y', v.vm_y));
      lines.push(cfgLine('viewmodel_offset_z', v.vm_z));

      lines.push(cfgLine('rate', v.rate));
      lines.push(cfgLine('cl_cmdrate', v.cmdrate));
      lines.push(cfgLine('cl_updaterate', v.updaterate));
      lines.push(cfgLine('snd_mixahead', v.mixahead));
      lines.push(cfgLine('volume', v.volume));
      lines.push(cfgLine('voice_enable', v.voice_enable));

      if (v.bind_jumpthrow) {
        const key = v.bind_jumpthrow;
        lines.push(`alias "+jumpthrow" "+jump; -attack; -attack2"`);
        lines.push(`alias "-jumpthrow" "-jump"`);
        lines.push(`bind ${key} "+jumpthrow"`);
      }
      if (v.bind_quickswitch) {
        const key = v.bind_quickswitch;
        lines.push(`bind ${key} "slot3; slot1"`);
      }

      if (v.custom && v.custom.trim().length) {
        lines.push('// --- Egne linjer ---');
        lines.push(v.custom.trim());
      }

      lines.push('host_writeconfig');

      const cfg = lines.join('\n');
      $('output').textContent = cfg + '\n';
      return cfg;
    }

    function download(text, filename) {
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    function importCfg(text) {
      const map = new Map();
      const known = [
        'sensitivity','zoom_sensitivity_ratio_mouse','m_rawinput','m_mouseaccel','m_mouseaccel1','m_mouseaccel2',
        'cl_crosshairsize','cl_crosshairthickness','cl_crosshairgap','cl_crosshairalpha','cl_crosshaircolor_r','cl_crosshaircolor_g','cl_crosshaircolor_b','cl_crosshair_drawoutline','cl_crosshair_outlinethickness','cl_crosshairdot',
        'viewmodel_fov','viewmodel_offset_x','viewmodel_offset_y','viewmodel_offset_z',
        'rate','cl_cmdrate','cl_updaterate','snd_mixahead','volume','voice_enable'
      ];
      const other = [];
      String(text).split(/\r?\n/).forEach(line => {
        const l = line.trim();
        if (!l || l.startsWith('//')) return;
        const m = l.match(/^(\S+)\s+(.+)$/);
        if (m) {
          const k = m[1];
          let val = m[2].replace(/^\"|\"$/g, '');
          if (known.includes(k)) map.set(k, val);
          else other.push(l);
        }
      });

      if (map.has('sensitivity')) $('sensitivity').value = map.get('sensitivity');
      if (map.has('zoom_sensitivity_ratio_mouse')) $('zoom_sens').value = map.get('zoom_sensitivity_ratio_mouse');
      if (map.has('m_rawinput')) $('m_rawinput').value = map.get('m_rawinput');
      const accel = map.get('m_mouseaccel') ?? map.get('m_mouseaccel1') ?? map.get('m_mouseaccel2');
      if (accel !== undefined) $('m_mouseaccel').value = accel;
      if (map.has('cl_crosshairsize')) $('ch_size').value = map.get('cl_crosshairsize');
      if (map.has('cl_crosshairthickness')) $('ch_thickness').value = map.get('cl_crosshairthickness');
      if (map.has('cl_crosshairgap')) $('ch_gap').value = map.get('cl_crosshairgap');
      if (map.has('cl_crosshairalpha')) $('ch_alpha').value = map.get('cl_crosshairalpha');
      if (map.has('cl_crosshaircolor_r')) $('ch_r').value = map.get('cl_crosshaircolor_r');
      if (map.has('cl_crosshaircolor_g')) $('ch_g').value = map.get('cl_crosshaircolor_g');
      if (map.has('cl_crosshaircolor_b')) $('ch_b').value = map.get('cl_crosshaircolor_b');
      if (map.has('cl_crosshair_drawoutline')) $('ch_outline').value = map.get('cl_crosshair_drawoutline');
      if (map.has('cl_crosshair_outlinethickness')) $('ch_outline_thickness').value = map.get('cl_crosshair_outlinethickness');
      if (map.has('cl_crosshairdot')) $('ch_dot').value = map.get('cl_crosshairdot');

      if (map.has('viewmodel_fov')) $('vm_fov').value = map.get('viewmodel_fov');
      if (map.has('viewmodel_offset_x')) $('vm_x').value = map.get('viewmodel_offset_x');
      if (map.has('viewmodel_offset_y')) $('vm_y').value = map.get('viewmodel_offset_y');
      if (map.has('viewmodel_offset_z')) $('vm_z').value = map.get('viewmodel_offset_z');

      if (map.has('rate')) $('rate').value = map.get('rate');
      if (map.has('cl_cmdrate')) $('cmdrate').value = map.get('cl_cmdrate');
      if (map.has('cl_updaterate')) $('updaterate').value = map.get('cl_updaterate');
      if (map.has('snd_mixahead')) $('mixahead').value = map.get('snd_mixahead');
      if (map.has('volume')) $('volume').value = map.get('volume');
      if (map.has('voice_enable')) $('voice_enable').value = map.get('voice_enable');

      if (other.length) $('custom').value = other.join('\n');
      updateEdpi();
      saveState();
      generateCfg();
    }

    fields.forEach(id => {
      const el = $(id);
      if (!el) return;
      el.addEventListener('input', () => {
        if (id === 'dpi' || id === 'sensitivity') updateEdpi();
        saveState();
      });
    });

    on('btn-generate', () => { generateCfg(); saveState(); });
    on('btn-generate-2', () => { generateCfg(); saveState(); });
    const doDownload = () => download(generateCfg(), 'autoexec.cfg');
    on('btn-download', doDownload);
    on('btn-download-2', doDownload);
    on('preset-apply', () => applyPreset($('preset-select')?.value));
    on('btn-copy', async () => {
      const t = generateCfg();
      try {
        await navigator.clipboard.writeText(t);
      } catch {
        alert('Kunne ikke kopiere. Marker teksten og kopier manuelt.');
      }
    });
    on('btn-reset', () => {
      if (confirm('Nulstil alle felter?')) {
        localStorage.removeItem('cs2_cfg_state');
        location.reload();
      }
    });

    const fileInput = $('file-import');
    if (fileInput) {
      fileInput.addEventListener('change', (e) => {
        const f = e.target.files?.[0];
        if (!f) return;
        const r = new FileReader();
        r.onload = () => importCfg(String(r.result || ''));
        r.readAsText(f);
      });
    }

    const SUPABASE_URL = 'https://fhrhpanpsfhqtpitkwvw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZocmhwYW5wc2ZocXRwaXRrd3Z3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMjQ2NjMsImV4cCI6MjA3MzgwMDY2M30.byKWY3wd1I_7XVEn4BzZGUmSxlte_ewlCFFh8YLIy9E';
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function updateAuthUI() {
      const { data: { user } } = await sb.auth.getUser();
      const loggedIn = !!user;
      $('btn-auth').style.display = loggedIn ? 'none' : '';
      $('btn-logout').style.display = loggedIn ? '' : 'none';
      show('landing', !loggedIn);
      const app = $('app');
      if (loggedIn) {
        app.classList.add('active');
      } else {
        app.classList.remove('active');
        app.style.display = 'none';
      }
      show(app, loggedIn);
    }

    async function saveCloud() {
      const cfg = generateCfg();
      const { data: { user } } = await sb.auth.getUser();
      if (!user) { $('auth-modal').classList.add('active'); return; }
      const { error } = await sb.from('autoexecs').upsert({ user_id: user.id, cfg }, { onConflict: 'user_id' });
      if (error) { alert('Fejl ved gem: ' + error.message); return; }
      alert('Gemt i skyen.');
    }

    async function loadCloud() {
      const { data: { user } } = await sb.auth.getUser();
      if (!user) { $('auth-modal').classList.add('active'); return; }
      const { data, error } = await sb.from('autoexecs').select('cfg').eq('user_id', user.id).single();
      if (error) { alert('Intet fundet for din konto.'); return; }
      importCfg(data.cfg);
      alert('Indlæst fra skyen.');
    }

    on('btn-auth', () => $('auth-modal').classList.add('active'));
    on('landing-signup', () => $('auth-modal').classList.add('active'));
    on('landing-login', () => $('auth-modal').classList.add('active'));
    on('auth-close', () => $('auth-modal').classList.remove('active'));
    on('auth-signup', async () => {
      const email = $('auth-email').value.trim();
      const password = $('auth-password').value;
      const { error } = await sb.auth.signUp({ email, password });
      if (error) { alert(error.message); return; }
      alert('Konto oprettet. Tjek evt. mail for verifikation.');
      $('auth-modal').classList.remove('active');
      updateAuthUI();
    });
    on('auth-login', async () => {
      const email = $('auth-email').value.trim();
      const password = $('auth-password').value;
      const { error } = await sb.auth.signInWithPassword({ email, password });
      if (error) { alert(error.message); return; }
      $('auth-modal').classList.remove('active');
      updateAuthUI();
    });
    on('btn-logout', async () => { await sb.auth.signOut(); updateAuthUI(); });

    on('btn-save-cloud', saveCloud);
    on('btn-load-cloud', loadCloud);

    function runSelfTests() {
      const results = [];
      try {
        const cfg1 = generateCfg();
        results.push(cfg1.includes('sensitivity'));
        importCfg(cfg1);
        const cfg2 = generateCfg();
        results.push(typeof cfg2 === 'string' && cfg2.length > 10);
        results.push(!!sb);
      } catch (e) {
        console.error('Selvtest fejl:', e);
        results.push(false);
      }
      const ok = results.every(Boolean);
      console.log('Selvtest:', results, 'OK=', ok);
      alert(ok ? 'Selvtest bestået' : 'Selvtest fejlede – se konsollen');
    }
    on('btn-selftest', runSelfTests);

    loadState();
    populatePresets();
    generateCfg();
    updateAuthUI();
    if (location.search.includes('test=1')) runSelfTests();
  </script>
</body>
</html>
